= ansible-cli.sh

// +-----------------------------------------------+
// |                                               |
// |    DO NOT EDIT HERE !!!!!                     |
// |                                               |
// |    File is auto-generated by pipline.         |
// |    Contents are based on bash script docs.    |
// |                                               |
// +-----------------------------------------------+


Command line interface to run Ansible playbooks.

== Overview

This Bash script allows the installation and uninstallation of Ansible Galaxy
modules and running Ansible playbooks. The script is designed to simplify the management of
Ansible modules and playbooks

The script uses a Docker container to run Ansible, ensuring that your system remains clean and
free from dependencies. The Docker container is pre-configured with Ansible and all required
dependencies.

In addition to module installation and uninstallation, the main purpose ot this script is to run
Ansible playbooks within the Docker container.

To run playbooks successfully, make sure to run `ssh-copy-id <REMOTE_USER>@<REMOTE_SERVER>.fritz.box`
first to ensure seamless connects to all remote machines.

[source, bash]

----
ssh-copy-id sebastian@caprica.fritz.box
ssh-copy-id sebastian@kobol.fritz.box
ssh-copy-id pi@prometheus.fritz.box
----

NOTE: Ansible expects the user `sebastian` to be present on all nodes. This user is the default
user for each node (workstation and RasPi). Normally this user is created from the setup wizard.
This scripts exits with `exitcode=8` if this user does not exist.

Overall, this script is designed to simplify the management of Ansible modules and playbooks by
providing a clean and automated environment for running them.

=== Prerequisites

Before using this script, you need to ensure that Docker and Docker Compose is installed on the
system. The script assumes that the Docker engine is running, and the user has necessary
permissions to execute Docker commands.

=== Ansible Playbooks

==== Ansible Playbook: desktops.yml

This Ansible playbook is designed to configure basic settings, directory structure, and software
packages for Ubuntu desktop machines. The playbook also includes some tasks that are shared with
other playbooks to ensure a consistent setup among all machines.

==== Ansible Playbook: raspi.yml

This Ansible playbook is designed to configure basic settings, directory structure, and software
packages for Raspberry Pi machines. The playbook also includes some tasks that are shared with
other playbooks to ensure a consistent setup among all machines but uses a reduced tasks set.

==== Ansible Playbook: desktops_steam.yml

This Ansible playbook is designed to install Steam on Ubuntu desktop machines.

==== Ansible Playbook: update-upgrade.yml

This Ansible playbook is designed to update all packages to their latest version and perform an
aptitude safe-upgrade on Ubuntu and RaspberryPi OS machines (both are Debian-based).

=== Script Arguments

The script does not accept any parameters.

== Index

* <<_invoke,invoke>>
* <<_ansible,ansible>>
* <<_ansible-playbook,ansible-playbook>>
* <<_ansible-galaxy,ansible-galaxy>>

=== invoke

Wrapper function to encapsulate ansible in a docker container using the
link:https://hub.docker.com/r/cytopia/ansible[cytopia/ansible] image.

Ansible runs in Docker as non-root user (the current user from the host is used inside the container).
Filesystem dependencies are mounted into the container to ensure the user inside the container shares
all relevant information with the user from the host.

The current working directory is mounted into the container and selected as working directory so that
all file of the project are available. Paths are preserved.

==== Example

[,bash]
----
echo "test: $(invoke ansible --version)"
----

==== Arguments

* *...* (String): The ansible commands (1-n arguments) - $1 is mandatory

==== Exit codes

* *8*: If param with ansible command is missing

=== ansible

Facade to map `ansible` command. The actual Ansible execution is delegated to
Ansible running in a Docker container.

==== Example

[,bash]
----
echo "test: $(ansible --version)"
----

==== Arguments

* *...* (String): The ansible-playbook commands (1-n arguments) - $1 is mandatory

=== ansible-playbook

Facade to map `ansible-playbook` command. The actual Ansible execution is delegated to
Ansible running in a Docker container.

==== Example

[,bash]
----
echo "test: $(ansible-playbook playbook.yml)"
----

==== Arguments

* *...* (String): The ansible-playbook commands (1-n arguments) - $1 is mandatory

=== ansible-galaxy

Facade to map `ansible-galaxy` command. The actual Ansible execution is delegated to
Ansible running in a Docker container.

==== Example

[,bash]
----
echo "test: $(ansible-galaxy install <extension>)"
----

==== Arguments

* *...* (String): The ansible-galaxy commands (1-n arguments) - $1 is mandatory
