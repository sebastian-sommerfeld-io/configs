= apply-config.sh

// +-----------------------------------------------+
// |                                               |
// |    DO NOT EDIT HERE !!!!!                     |
// |                                               |
// |    File is auto-generated by pipline.         |
// |    Contents are based on bash script docs.    |
// |                                               |
// +-----------------------------------------------+


Apply Github config for all repositories based.

== Overview

This script applies a consistent configuration across all
link:https://github.com/sebastian-sommerfeld-io?tab=repositories[Github repositories]. using
Terraform. The link:https://registry.terraform.io/providers/integrations/github/latest/docs[Terraform Github Provider]
allows interaction with Github. Terraform is started inside a docker container, so there is no
need to install Terraform on your machine.

Terraform is an open-source infrastructure as code software tool that enables you to safely and
predictably create, change, and improve infrastructure. It provides infrastructure automation with
workflows to build composition, collaboration, and reuse of infrastructure as code.

TODO Link to pipeline

.Available Terraform commands
include::ROOT:partial$GENERATED/github/config/help.adoc[]

TODO link to run-in-pipeline-order.sh / simulate-pipeline.sh

=== Script Arguments

* _$1_ (string): The `terraform` command to run.

=== Script Example

To run this script locally, run the commands in the same order as the pipeline does (see docs for
each function). Running this script without arguments will result in errors.

[source, bash]

----
./apply-config.sh validate
./apply-config.sh fmt
./apply-config.sh plan
./apply-config.sh apply
----

== Index

* <<_terraform,terraform>>
* <<_apply,apply>>
* <<_format,format>>
* <<_initialize,initialize>>
* <<_plan,plan>>
* <<_validate,validate>>
* <<_version,version>>

=== terraform

Wrapper function to encapsulate terraform in a docker container. The current working
directory is mounted into the container and selected as working directory so that all file are
available to terraform. Paths are preserved. The container runs with the current user.

==== Example

[,bash]
----
terraform -version
----

==== Arguments

* *...* (String): The terraform commands (1-n arguments) - $1 is mandatory

==== Exit codes

* *8*: If param with terraform command is missing

=== apply

Apply this configuration by running `terraform apply -auto-approve -var="gh_token=<GITHUB_PAT>"`.
Pipeline Step 6.

==== Example

[,bash]
----
apply
----

=== format

Apply consistent format to all .tf files by running `terraform fmt -recursive`.
Pipeline Step 4.

==== Example

[,bash]
----
fmt
----

=== initialize

Initialize this configuration by running `terraform init`.
Pipeline Step 2.

==== Example

[,bash]
----
initialize
----

=== plan

Plan this configuration by running `terraform plan -var="gh_token=<GITHUB_PAT>"`.
Pipeline Step 5.

==== Example

[,bash]
----
plan
----

=== validate

Validate Terraform configuration by running `terraform validate`.
Pipeline Step 3.

==== Example

[,bash]
----
validate
----

=== version

Show Terraform version by running `terraform -version`.
Pipeline Step 1.

==== Example

[,bash]
----
version
----
